<!DOCTYPE html>
<html>

<head>
    <title>ESP32-CAM Stream</title>
</head>

<body>
    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
    <li><a class="dropdown-item" href="/camera">Camera</a></li>
    <li><a class="dropdown-item" href="/users">User</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="#">Something else here</a></li>
    </ul>
    <h1>Live Stream from ESP32-CAM</h1>
    <h2 id="recognized-name">Đang nhận diện...</h2>
    <p id="employee-info"></p>
    <img src="{{ url_for('video_feed') }}" width="640" height="480" />
    <br><br>
    <a href="{{ url_for('export_to_excel') }}"><button>Export to Excel</button></a>
    <script>
        setInterval(async () => {
            try {
                const res = await fetch('/report');
                if (!res.ok) {
                    console.error("Error fetching report:", res.status, res.statusText);
                    return;
                }
                const data = await res.json();
                console.log("Report data:", data);
                if (Array.isArray(data) && data.length > 0) {
                    const latest = data[0];
                    document.getElementById('recognized-name').innerText = "Người nhận diện gần nhất: " + latest.name;
                    document.getElementById('employee-info').innerText =
                        `ID: ${latest.employee_id || 'N/A'}, DOB: ${latest.dob || 'N/A'}, Position: ${latest.position || 'N/A'}, Confidence: ${latest.confidence?.toFixed(2) || 'N/A'}`;
                }
            } catch (error) {
                console.error("Fetch error:", error);
            }
        }, 2000);
    </script>
</body>

</html>